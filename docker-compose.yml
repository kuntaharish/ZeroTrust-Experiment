services:
  legacy_node_1:
    build:
      context: ./app
      dockerfile: Dockerfile
    ports:
      - "5001:5000"
    environment:
      - ZT_ENABLED=false
    command: ["gunicorn", "-b", "0.0.0.0:5000", "app:app"]

  legacy_node_2:
    build:
      context: ./app
      dockerfile: Dockerfile
    ports:
      - "5002:5000"
    environment:
      - ZT_ENABLED=false
    command: ["gunicorn", "-b", "0.0.0.0:5000", "app:app"]

  zt_app_1:
    build:
      context: ./app
      dockerfile: Dockerfile
    environment:
      - ZT_ENABLED=true
    expose:
      - "5000"
    command: ["gunicorn", "-b", "0.0.0.0:5000", "app:app"]

  zt_proxy_1:
    image: nginx:1.27-alpine
    depends_on:
      - zt_app_1
    ports:
      - "6001:443"
    volumes:
      - ./nginx/zt_1.conf:/etc/nginx/conf.d/default.conf:ro
      - ./certs:/certs:ro

  zt_app_2:
    build:
      context: ./app
      dockerfile: Dockerfile
    environment:
      - ZT_ENABLED=true
    expose:
      - "5000"
    command: ["gunicorn", "-b", "0.0.0.0:5000", "app:app"]

  zt_proxy_2:
    image: nginx:1.27-alpine
    depends_on:
      - zt_app_2
    ports:
      - "6002:443"
    volumes:
      - ./nginx/zt_2.conf:/etc/nginx/conf.d/default.conf:ro
      - ./certs:/certs:ro
